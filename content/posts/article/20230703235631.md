+++
title = "WSLコマンド、設定、備忘録"
author = ["Marigold"]
date = 2023-07-03
lastmod = 2023-07-06T07:11:06+09:00
tags = ["article", "bash", "WSL", "ubuntu"]
draft = false
+++

<div class="ox-hugo-toc toc has-section-numbers">

<div class="heading">Table of Contents</div>

- <span class="section-num">1</span> [インストール](#インストール)
- <span class="section-num">2</span> [ログアウトとシャットダウン](#ログアウトとシャットダウン)
- <span class="section-num">3</span> [X Serverをインストール](#x-serverをインストール)
    - <span class="section-num">3.1</span> [mozc X server上での日本語入力](#mozc-x-server上での日本語入力)
        - [基礎的なこと](#基礎的なこと)
        - [Input methodをインストール](#input-methodをインストール)
        - [環境変数の設定](#環境変数の設定)
        - [xset](#xset)
        - [emacs](#emacs)
    - <span class="section-num">3.2</span> [辞書登録](#辞書登録)
    - <span class="section-num">3.3</span> [fcitx icon error](#fcitx-icon-error)
- <span class="section-num">4</span> [フォントをインストール](#フォントをインストール)
- <span class="section-num">5</span> [.bashrc](#dot-bashrc)
    - <span class="section-num">5.1</span> [日本語設定](#日本語設定)
    - <span class="section-num">5.2</span> [ctrl-Dでログアウトしないようにする](#ctrl-dでログアウトしないようにする)
- <span class="section-num">6</span> [apt パッケージ管理](#apt-パッケージ管理)
    - <span class="section-num">6.1</span> [パッケージ一覧アップデートとアップグレード](#パッケージ一覧アップデートとアップグレード)
    - <span class="section-num">6.2</span> [インストール](#インストール)
    - <span class="section-num">6.3</span> [アンインストール](#アンインストール)
    - <span class="section-num">6.4</span> [version確認](#version確認)
- <span class="section-num">7</span> [aptを使わないインストール](#aptを使わないインストール)
- <span class="section-num">8</span> [Windowsのコマンドを使う](#windowsのコマンドを使う)
    - <span class="section-num">8.1</span> [Pathが通っている場合](#pathが通っている場合)
    - <span class="section-num">8.2</span> [wslpath windows linux間でパスを変換する](#wslpath-windows-linux間でパスを変換する)

</div>
<!--endtoc-->



## <span class="section-num">1</span> インストール {#インストール}

[WSLを使用してWindowsにLinuxをインストールする]({{< relref "20230703220444.md" >}})


## <span class="section-num">2</span> ログアウトとシャットダウン {#ログアウトとシャットダウン}

`C-d` `logout` はログアウト。
ubuntuをシャットダウンしたいときは `wsl --shutdown` を実行する。


## <span class="section-num">3</span> X Serverをインストール {#x-serverをインストール}

1.  GUI環境を作るために[VcXsrv](https://sourceforge.net/projects/vcxsrv/)をインストール。
2.  ダウンロードしたら手順に沿ってインストールする。
3.  起動時にSave Configurationで出力したファイル(config.xlaunch)をスタートアップフォルダに入れるとPC起動時に自動実行できるようになる。

    私の設定は以下

    -   Multiple windows
    -   Start no client

    以下をチェック

    -   Clip board
        -   primary selection
    -   Native opengl
    -   Disable access control
4.  WSL2を使っている場合、
    ```shell
    export DISPLAY=`hostname`.mshome.net:0.0
    ```
    を.bashrcに書き込めばemacsなどのGUIソフトを起動できるようになる。


### <span class="section-num">3.1</span> mozc X server上での日本語入力 {#mozc-x-server上での日本語入力}


#### 基礎的なこと {#基礎的なこと}

内容は[Yasuhiro ABE, The University of Aizu. | YYY.【2022年度まで】uimによる日本語入力](https://u-aizu.ac.jp/~yasu-abe/ja/sccp/manual/thinkpadime/)から

一番基底にあるのはXserver、その上にGTK, QTなどのDesktop環境、その上にfcitxなどのInput Method(IM)、さらに上に変換エンジン(連文節変換、予測変換)、mozcは予測変換。


#### Input methodをインストール {#input-methodをインストール}

[WSL2上のUbuntu20.04でのEmacs](https://www.aise.ics.saitama-u.ac.jp/~gotoh/EmacsUbuntu2004onWSL2.html)

fcitxを使う。

```shell
sudo apt install fcitx fcitx-mozc
#xsetを実行するために必要
sudo apt install x11-xserver-utils
#imput methodをfcitxに
im-config -n fcitx
#UUID Universally Unique ID。MACアドレスと時刻から作る重複しないID
sudo sh -c "dbus-uuidgen > /var/lib/dbus/machine-id"
```


#### 環境変数の設定 {#環境変数の設定}

.bashrcに以下を書く

```shell
# IMはIMPUT METHOD
export GTK_IM_MODULE=fcitx
export QT_IM_MODULE=fcitx
export XMODIFIERS=@im=fcitx
export DefaultIMModule=fcitx
# Shell levelが1なら、fcitxを自動実行する。

if [ $SHLVL = 1 ] ; then
  (fcitx-autostart > /dev/null 2>&1 &)
  # xset -r はkey repeatの無効(-r)、有効(r)の切り替え。
  # 無効だと押しっぱなしにしても連続入力されなくなる。
  # xset -r 49  > /dev/null 2>&1
  xset r rate 400 40
fi
```

ここまででXserver上で日本語入力ができるようになる。


#### xset {#xset}

上にあるxsetについてもう少し詳しく。 `xset q` で現在の設定を確認することができる。

> auto repeat:  on

は上に書いたとおり。

> xset -r 49

は[20160905: Ubuntu の日本語入力機能の不具合 - PIB](https://seesaawiki.jp/w/kou1okada/d/20160905%3A%20Ubuntu%20%A4%CE%C6%FC%CB%DC%B8%EC%C6%FE%CE%CF%B5%A1%C7%BD%A4%CE%C9%D4%B6%F1%B9%E7)が詳しい。
49は半角/全角キーのキーコードでこのキーのオートリピートを無効にしているとのこと。

> auto repeat delay:  500    repeat rate:  31

`xset r rate DELAY RATE` で設定できる。delayはキー押下後何ms後からリピートするか。rateはその速さ、大きいほどリピート間隔が短くなる。

emacsで日本語を入力していると、同じ文字が連続入力されて制御できなくなることがあるが、このあたりに原因があったのかもしれない。


#### emacs {#emacs}

27では異常に重くてVersion28.1だと安定する。
[aptでemacsの最新版をインストールする]({{< relref "20230704225116.md" >}})を参考に最新版を入れたほうが良い。

```emacs-lisp
(require 'mozc)  ; or (load-file "/path/to/mozc.el")
(setq mozc-candidate-style 'echo-area)
(require 'mozc-im)
(setq default-input-method "japanese-mozc-im")
```

mozc と mozc-im をインストールしておく。


### <span class="section-num">3.2</span> 辞書登録 {#辞書登録}

```shell
/usr/lib/mozc/mozc_tool --mode=dictionary_tool
```


### <span class="section-num">3.3</span> fcitx icon error {#fcitx-icon-error}

使用していると

> Error loading theme icon 'edit-paste' for stock: Icon 'edit-paste' not present in theme Yaru

というエラーが出るかもしれない。この場合は

```shell
sudo apt install yaru-theme-icon
```

でアイコンをインストールできる。


## <span class="section-num">4</span> フォントをインストール {#フォントをインストール}

インストールしたいフォントを `/usr/share/fonts/` にコピーする。アクセス権の関係で拒否されるかもしれないので、一度ホームディレクトリに置いてからmvコマンドで移動させる。

```shell
sudo mv ~/HackGen/ /usr/share/fonts
```

フォントキャッシュを更新する。

```shell
fc-cache -fv
```

参考

-   [Linux にプログラミングフォント「白源 (はくげん／HackGen)」を追加し、 VS Code に導入する方法 | ランディネットワーク](https://www.randynetwork.com/blog/hackgen-introduce/)


## <span class="section-num">5</span> .bashrc {#dot-bashrc}


### <span class="section-num">5.1</span> 日本語設定 {#日本語設定}

インストールされていないなら言語パッケージをインストールする。

```shell
sudo apt install language-pack-ja
```

```shell
export LANGUAGE=ja_JP.UTF-8
```


### <span class="section-num">5.2</span> ctrl-Dでログアウトしないようにする {#ctrl-dでログアウトしないようにする}

```shell
set -o ignoreeof
```


## <span class="section-num">6</span> apt パッケージ管理 {#apt-パッケージ管理}


### <span class="section-num">6.1</span> パッケージ一覧アップデートとアップグレード {#パッケージ一覧アップデートとアップグレード}

[WSL 開発環境を設定する | Microsoft Learn](https://learn.microsoft.com/ja-jp/windows/wsl/setup/environment)

```shell
sudo apt update && sudo apt upgrade
```


### <span class="section-num">6.2</span> インストール {#インストール}

```shell
sudo apt install
```


### <span class="section-num">6.3</span> アンインストール {#アンインストール}

```shell
sudo apt remove
```


### <span class="section-num">6.4</span> version確認 {#version確認}

```shell
apt list sqlite3 -a
```

あるいは

```shell
apt policy sqlite3
```


## <span class="section-num">7</span> aptを使わないインストール {#aptを使わないインストール}

[aptに最新バージョンがない場合に最新のパッケージをインストールする]({{< relref "20230702171536.md" >}})

[aptでemacsの最新版をインストールする]({{< relref "20230704225116.md" >}})


## <span class="section-num">8</span> Windowsのコマンドを使う {#windowsのコマンドを使う}

-   [ファイル システム間での作業 | Microsoft Learn](https://learn.microsoft.com/ja-jp/windows/wsl/filesystems#run-windows-tools-from-linux)
-   [WSL 開発環境を設定する | Microsoft Learn](https://learn.microsoft.com/ja-jp/windows/wsl/setup/environment#basic-wsl-commands)
-   [WSL2上でopenコマンドを実行できるようにする - HRR Co., Ltd.](https://hrroct.hatenablog.com/entry/2022/10/12/152619)
-   [start コマンドで起動したい実行パスに空白が含まれる場合 単純に""で囲ってもダメ](https://anond.hatelabo.jp/20110805143611)


### <span class="section-num">8.1</span> Pathが通っている場合 {#pathが通っている場合}

`ipconfig.exe` のように拡張子 `.exe` を含めてコマンドを実行すればそのまま実行できる。


### <span class="section-num">8.2</span> wslpath windows linux間でパスを変換する {#wslpath-windows-linux間でパスを変換する}

`wslpath -w /` で `\\wsl.localhost\Ubuntu\` が出力される。

```shell
function open() {
    path_name=$1
    if [ $# -eq 0 ]; then
    path_name="."
    elif [ $# -gt 1 ]; then
    echo "open: $* : Set only one directory or file path" 1>&2
    return 1
    fi

    if [ -e "${path_name}" ]; then
    path1=$(readlink -f "$1")
    path2=$(wslpath -w -a "${path1}" 2> /dev/null)
    cmd.exe /c start "" "${path2}"
    else
    echo "open: ${path_name} : No such file or directoty" 1>&2
    return 1

    fi

    return 0
    }
```

これを.bashrcに書いておくと

```shell
open path/to/foo.pdf
```

でwindowsのデフォルトアプリでpdfを起動できる。ただし、 `\\wsl.localhost\Ubuntu\` 内にあるファイルを開こうとすると以上に時間がかかる。この場合は何らかのソフトをubuntuに入れてXserver上で開くべきで、このやり方は
windowsにあるファイルをubuntuから開きたい場合のやり方と考えたほうが良い。

[aptでgoogle chromeをインストールする]({{< relref "20230706070546.md" >}})